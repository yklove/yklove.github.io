---
title: （一）自己动手写操作系统——环境搭建
categories:
  - 自己动手写操作系统
tags:
  - 操作系统
date: 2020-10-31 17:10:43
---

# （一）自己动手写操作系统——环境搭建



> 环境：Mac OS 10.15.4



### 一、安装NASM

```bash
brew install nasm
```

> NASM全称The Netwide Assembler，是一款基于80x86和x86-64平台的汇编语言编译程序
>
> 注：执行命令需要先安装brew，使用的版本为：2.14.02

<!-- more -->

### 二、安装VirtualBox

```shell
brew cask install virtualbox
```

> *VirtualBox*是一款简单易用还免费的开源虚拟机
>
> 注：执行命令需要安装brew cask，使用的版本为：6.0.14

### 三、编写代码

新建文件：boot.asm

```assembly
    org 07c00h          ;
    mov ax, cs
    mov ds, ax
    mov es, ax
    call DispStr        ;
    jmp $               ;

DispStr:
    mov ax, BootMessage
    mov bp, ax          ;
    mov cx, 16          ;
    mov ax, 01301h      ;
    mov bx, 000ch       ;
    mov dl, 0
    int 10h             ;
    ret
BootMessage:    db "Hello, OS world!"
times 510-($-$$) db 0   ;
                        ;
dw 0xaa55               ;
```

### 四、编译

```shell
nasm boot.asm -o boot.bin
```

### 五、制作为映像文件

```shell
dd if=boot.bin of=boot.img bs=512 count=1
```

>注：
>
>1. 制作软盘镜像文件diska.img
>  命令： dd if=/dev/zero of=diska.img bs=512 count=2880
>
>2. 复制boot.bin到boot.img中
>  命令： dd if=boot.bin of=boot.img bs=512 count=1
>
>3. 复制diska.img中从第512字节往后的内容添加到boot.img中（这是dd最出彩的部分）
>命令： dd if=diska.img of=boot.img skip=1 seek=1 bs=512 count=2879
>
>来源：https://blog.csdn.net/sunjing/article/details/78781411

### 六、运行

#### 1、打开VirtualBox，新建虚拟机，选择类型和版本均为Other：

![image-20201031110227855](/uploads/image-20201031110227855.png)

#### 2、内存选择32M：

![image-20201031105405924](/uploads/image-20201031105405924.png)

#### 3、创建一个虚拟磁盘备用：

![image-20201031105426123](/uploads/image-20201031105426123.png)

![image-20201031105436240](/uploads/image-20201031105436240.png)

![image-20201031105446030](/uploads/image-20201031105446030.png)

![image-20201031105455294](/uploads/image-20201031105455294.png)

#### 4、创建完毕后，在创建的虚拟机上打开设置选项：

![image-20201031114138866](/uploads/image-20201031114138866.png)

#### 5、选择存储选项：

![image-20201031114207186](/uploads/image-20201031114207186.png)

#### 6、添加软盘控制器：

![image-20201031110359648](/uploads/image-20201031110359648.png)

#### 7、添加虚拟软驱：

![image-20201031110632692](/uploads/image-20201031110632692.png)

#### 8、点击注册，选择刚刚制作的boot.img：

![image-20201031105826100](/uploads/image-20201031105826100.png)

![image-20201031105834798](/uploads/image-20201031105834798.png)

![image-20201031105857565](/uploads/image-20201031105857565.png)

#### 9、点击ok，保存设置。

#### 10、接下来启动虚拟机：

![image-20201031110815526](/uploads/image-20201031110815526.png)